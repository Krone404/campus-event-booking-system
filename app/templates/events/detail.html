{% extends "base.html" %}
{% block content %}
<h1>{{ event.title }}</h1>

<p><strong>Location:</strong> {{ event.location }}</p>
<p><strong>Time:</strong> {{ event.start_time }} to {{ event.end_time }}</p>
<p><strong>Capacity:</strong> {{ event.capacity }}</p>

{% if event.description %}
  <p><strong>Description:</strong><br>{{ event.description }}</p>
{% endif %}

{% if current_user.is_authenticated %}
  <form method="post" action="{{ url_for('events.book_event', event_id=event.id) }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit">Book</button>
  </form>
{% else %}
  <small><a href="/auth/login">Login</a> to book</small>
{% endif %}

<hr>

{% if maps_js_key and event.lat is not none and event.lng is not none %}
  <h2>Map</h2>
  <div id="map" style="width:100%; height:360px; border:1px solid #ccc;"></div>

  <script>
    function initMap() {
      const pos = { lat: {{ event.lat }}, lng: {{ event.lng }} };

      const map = new google.maps.Map(document.getElementById("map"), {
        center: pos,
        zoom: 16,
      });

      new google.maps.Marker({
        position: pos,
        map: map,
        title: "{{ event.title|e }}",
      });
    }
  </script>

  <script
    src="https://maps.googleapis.com/maps/api/js?key={{ maps_js_key }}&callback=initMap"
    async
    defer
  ></script>
{% else %}
  <p><small>Map not available (missing MAPS_API_KEY or event coordinates).</small></p>
{% endif %}
{% endblock %}
